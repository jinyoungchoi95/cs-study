### 프로그램(Program)

- 파일이 저장 장치에 저장되어 있지만 메모리에는 올라가지 않은 정적인 상태



### 프로세스(Process)

- 실행 중인 프로그램으로 디스크로부터 메모리에 적재되어 CPU 의 할당을 받을 수 있는 것을 말한다.
- os로 부터 주소공간, 파일, 메모리등을 할당받는데 이를 통칭해서 프로세스라고 한다.
- **운영체제로부터 메모리를 할당받아서 사용되는 작업단위**
- 독립된 메모리 영역을 code, data, stack, heap 형태로 할당해준다.
- 매개변수, 지역변수 등을 갖는 **프로세스 스택**과 전역변수를 수록하는 **데이터 섹션**이 포함된다.
- 또한 프로세스 실행 중에 동적으로 생성되는 메모리인 힙 또한 포함한다.
- PCB(Process  Control Block)을 포함하는데 CPU를 할당받아서 작업을 처리하다가 다른 프로세스로 전환할 때(context switching) 프로세스의 정보를 PCB에 담아서 전달한다.



### 스레드(Thread)

- 프로세스의 실행 단위
- 스레드ID, 프로그램 카운터, 레지스터 집합, 스택으로 구성된다.
- 같은 프로세스에 속한 다른 스레드와 코드, 데이터 섹션, 열린 파일이나 신호같은 os 자원들을 공유한다.
- 단 스레드는 프로세스 내에서 스택만 따로 할당받고, 코드, 데이터, 힙등은 공유한다.
- 각각의 스레드는 독립적인 작업을 수행하기 때문에 각자의 **스택과 PC 레지스터 값**을 가지고 있다.
- 하나의 프로세스에 대해서 다수의 실행 단위(스레드)로 구분하여 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 수행능력을 향상시킨것을 **멀티 스레딩**이라고 한다.
- 결국 프로세스 내의 자원을 공유하기 때문에 자원에 대한 접근이 쉽고 컨텍스트 스위칭 비용이 적어진다.



- 스택을 스레드마다 독립적으로 할당하는 이유
  - 스택을 독립적으로 할당했다는 것은 독랍적인 메모리공간을 주어졌다는 것이고 결국 독립적인 함수 호출이 가능하게 해준것이다. 즉, 독립성을 추가해준다는 것이다.
- PC 레지스터 값을 스레드마다 독립적으로 할당하는 이유
  - PC 값은 스레드가 명령어의 어디까지 수행했는지 수행 흐름을 나타낸다. 스레드는 CPU를 할당 받았다가 스케쥴러에 의해 언젠가 다시 선점당한다. 따라서 명령어가 연속적으로 수행되지 못하고 어느부분까지 수행되는지 확인하는 것이 필요하기 때문에 PC 레지스터를 독립적으로 할당하는 것이다.



### 멀티 스레드 Vs 멀티 프로세스

 멀티 스레드는 한 프로세스 내에서 data, heap, code 영역을 공유하기 때문에 적은 메모리 공간을 차지하고 컨텍스트 전환이 빠르다는 장점이 있다. 하지만 하나의 스레드가 종료되면 다른 전체 스레드가 함께 종료된다는 점과 동기화의 문제를 같이 앉고있다.

 멀티 프로세스는 각각 독립적인 메모리를 사용하기 때문에 많은 메모리 공간과 cpu시간을 차지한다는 단점이 있지만 하나의 프로세스가 죽어도 다른 프로세스에 영향이 가지 않는다는 장점이 있다.

(그렇다고 프로세스가 다른 프로세스의 정보를 아예 못가져온다는 것은 아니다. IPC, LPC, 별도 공유메모리를 만들어 정보를 주고받는등 방법은 많다. 하지만 RAM과 CPU 사시의 캐시 메모리까지 초기화되기 때문에 자원 부담이 크다.)



### 컨텍스트 스위칭이란?

 현재 프로세스나 스레드의 상태를 저장하고 다음 진행할 task의 상태를 읽어서 실행하는 과정을 말한다.

 프로세스에서의 컨텍스트 스위칭은 이동할때마다 캐시 메모리가 초기화되는 등 비용이 많이든다.



### 멀티 스레드의 단점

 스레드는 한 프로세스내에서 다른 스레드와 힙, 코드, 데이터 영역을 공유한다. 따라서 어떤 스레드가 사용중인 데이터에 대해서 접근할 때 서로 접근이 꼬여 잘못된 값을 읽어올 수 있으므로 이를 동기화하는 작업이 필요하다.

> 동기화란
>
> 스레드들에게 하나의 자원에 대한 처리 권한을 주거나 순서를 조정해주는 기법이다.

 근데 과도한 락을 통해서 병목현상이 발생하여 성능이 저하될 수있다. 불필요한 메모리까지 동기화를 할 경우 병목현상이 발생하기 때문에 전체 성능에 악영향을 끼친다. 따라서 동기화를 할 때는 메소드 전체를 동기화할 것인지, 아니면 특정 부분만 동기화할 것인지에 대한 선택이 필요하다.



뮤텍스, 세마포어, 모니터 3가지 동기화방법이 있다.
